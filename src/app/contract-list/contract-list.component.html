<div class="mat-elevation-z8 main">
    <mat-expansion-panel expanded='true'>
        <mat-expansion-panel-header>
            <mat-panel-title>検索条件</mat-panel-title>
        </mat-expansion-panel-header>
        <div class="search-div">
            <table class="search-tbl">
                <tr>
                    <th>物件番号</th>
                    <td>
                        <input type="text" [(ngModel)]="cond.bukkenNo">
                    </td>
                    <th>物件名</th>
                    <td colspan="3">
                        <input type="text" class="fuzzyWidth400" [(ngModel)]="cond.bukkenName">
                    </td>                    
                </tr>
                <tr>
                    <th>契約番号</th>
                    <td>
                        <input type="text" [(ngModel)]="cond.contractNumber">
                    </td>
                    <th>明渡期日</th>
                    <td>
                        <div class="picker-div">
                            <input type="text" [matDatepicker]="vacationDay" class="width150" [(ngModel)]="cond.vacationDayMap">
                            <mat-datepicker-toggle matSuffix [for]="vacationDay" class="picker-icon"></mat-datepicker-toggle>
                            <mat-datepicker #vacationDay></mat-datepicker>
                        </div>
                    </td>
                    <th>契約日</th>
                    <td>
                        <div class="picker-div">
                            <input type="text" [matDatepicker]="contractDay" class="width150" [(ngModel)]="cond.contractDayMap">
                            <mat-datepicker-toggle matSuffix [for]="contractDay" class="picker-icon"></mat-datepicker-toggle>
                            <mat-datepicker #contractDay></mat-datepicker>
                        </div>
                    </td>
                </tr>       
            </table>      
            <div style="margin: 10px 0px 10px 0px;">
                <button mat-raised-button (click)="searchContract()" class="search-btn">&nbsp;&nbsp;検索&nbsp;&nbsp;</button>&nbsp;&nbsp;
            </div>
        </div>                   
    </mat-expansion-panel>

    <ngx-spinner type="ball-spin-clockwise" bdOpacity="0.7"></ngx-spinner>
    <div style="margin-top: 10px;">

        <table mat-table [dataSource]="dataSource" matSort>
        
            <!-- bukkenId Column -->
            <ng-container matColumnDef="bukkenNo">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> 物件番号 </th>
                <td mat-cell *matCellDef="let element" > {{element.bukkenNo}} </td>
            </ng-container>
        
            <!-- bukkenName Column -->
            <ng-container matColumnDef="bukkenName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> 物件名 </th>
            <td mat-cell *matCellDef="let element"> {{element.bukkenName}} </td>
            </ng-container>
        
            <!--所在地-->
            <ng-container matColumnDef="remark1">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> 所在地 </th>
            <td mat-cell *matCellDef="let element">{{element.remark1}}</td>
            </ng-container>

            <!--地番-->
            <ng-container matColumnDef="remark2">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> 地番 </th>
            <td mat-cell *matCellDef="let element">{{element.remark2 != null ? element.remark2 : '　'}}</td>
            </ng-container>    
        
            <!--契約番号-->
            <ng-container matColumnDef="contractNo">
            <th mat-header-cell *matHeaderCellDef> 契約番号 </th>
            <td mat-cell *matCellDef="let element">
                <div *ngFor="let ct of element.contracts; index as pos" [ngClass]="{'ct-list': true, 'ct-notlast': (pos < element.contracts.length - 1)}">{{element.bukkenNo + '-' + ct.contractNumber}}</div>                
            </td>
            </ng-container>

            <!--区分-->
            <ng-container matColumnDef="buildingType">
            <th mat-header-cell *matHeaderCellDef> 区分 </th>
            <td mat-cell *matCellDef="let element">
                <div *ngFor="let ct of element.contracts; index as pos" [ngClass]="{'ct-list': true, 'ct-notlast': (pos < element.contracts.length - 1)}">{{getLocationType(ct.details[0].locationInfoPid, element.locations)}}</div> 
            </td>
            </ng-container>

            <!--契約者-->
            <ng-container matColumnDef="contractOwner">
            <th mat-header-cell *matHeaderCellDef> 契約者 </th>
            <td mat-cell *matCellDef="let element">
                <div *ngFor="let ct of element.contracts; index as pos" [ngClass]="{'ct-list': true, 'ct-notlast': (pos < element.contracts.length - 1)}">{{ct.details[0].contractorName}}</div>
            </td>
            </ng-container>
        
            <!-- 詳細 Column -->
            <ng-container matColumnDef="detail">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let element"> 
                <div *ngFor="let ct of element.contracts; index as pos" [ngClass]="{'ct-list': true, 'ct-notlast': (pos < element.contracts.length - 1)}">
                    <button mat-raised-button (click)="showContract(ct)" color="warn">詳細</button>
                </div>                
            </td>
            </ng-container>
        
            <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
        <mat-paginator [pageSizeOptions]="[10, 20, 50]" showFirstLastButtons></mat-paginator>
    </div>

</div>    


