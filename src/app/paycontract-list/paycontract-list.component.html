<div class="mat-elevation-z8 main">
    <mat-expansion-panel expanded='true'>
        <mat-expansion-panel-header>
            <mat-panel-title>検索条件</mat-panel-title>
        </mat-expansion-panel-header>
        <div class="search-div">
        <table class="search-tbl">                
            <tr>
                <th>物件番号</th>
                <td colspan="3">
                    <input type="text" class="width300" [(ngModel)]="cond.bukkenNo">
                </td>
                <th>物件名</th>
                <td colspan="3">
                    <input type="text" class="fuzzyWidth400" [(ngModel)]="cond.bukkenName">
                </td>
            </tr>    
            <tr>
                <th>取引先</th>
                <td colspan="3">
                    <input type="text" class="fuzzyWidth400" [(ngModel)]="cond.supplierName">
                </td>
                <!--hiranomemo 契約予定日はtblPayContractのcontractDayカラム-->
                <th>契約予定日(開始)</th>
                <td class="picker-div_1">
                <div class="picker-div">
                <input type="text" [matDatepicker]="contractDay_From" [(ngModel)]="cond.contractDay_From" class="width100">
                <mat-datepicker-toggle matSuffix [for]="contractDay_From" class="picker-icon"></mat-datepicker-toggle>
                <mat-datepicker #contractDay_From></mat-datepicker>
                </div>
                </td>
                <th>契約予定日(終了)</th>
                <td>
                <div class="picker-div_1">
                <input type="text" [matDatepicker]="contractDay_To" [(ngModel)]="cond.contractDay_To" class="width100">
                <mat-datepicker-toggle matSuffix [for]="contractDay_To" class="picker-icon"></mat-datepicker-toggle>
                <mat-datepicker #contractDay_To></mat-datepicker>
                </div>
                </td>
            </tr> 
            <tr>
                <th>契約確定日(開始)</th>
                <td class="picker-div_1">
                <div class="picker-div">
                <input type="text" [matDatepicker]="contractFixDay_From" [(ngModel)]="cond.contractFixDay_From" class="width100">
                <mat-datepicker-toggle matSuffix [for]="contractFixDay_From" class="picker-icon"></mat-datepicker-toggle>
                <mat-datepicker #contractFixDay_From></mat-datepicker>
                </div>
                </td>
                <th>契約確定日(開始)</th>
                <td class="picker-div_1">
                <div class="picker-div">
                <input type="text" [matDatepicker]="contractFixDay_To" [(ngModel)]="cond.contractFixDay_To" class="width100">
                <mat-datepicker-toggle matSuffix [for]="contractFixDay_To" class="picker-icon"></mat-datepicker-toggle>
                <mat-datepicker #contractFixDay_To></mat-datepicker>
                </div>
                </td>
                <th>支払種別</th>
                <td colspan="3">
                    <app-select-component  class="width158" [codes]="getPaymentTypes()" [(ngModel)]="cond.paymentCode"></app-select-component>
                </td>
            </tr>
            <tr>
                <!--hiranomemo 支払予定日はtblPayContractDetailのcontractDayカラム-->
                <th>支払予定日(開始)</th>
                <td class="picker-div_1">
                <div class="picker-div">
                <input type="text" [matDatepicker]="payDay_From" [(ngModel)]="cond.payDay_From" class="width100">
                <mat-datepicker-toggle matSuffix [for]="payDay_From" class="picker-icon"></mat-datepicker-toggle>
                <mat-datepicker #payDay_From></mat-datepicker>
                </div>
                </td>
                <th>支払予定日(終了)</th>
                <td>
                <div class="picker-div_1">
                <input type="text" [matDatepicker]="payDay_To" [(ngModel)]="cond.payDay_To" class="width100">
                <mat-datepicker-toggle matSuffix [for]="payDay_To" class="picker-icon"></mat-datepicker-toggle>
                <mat-datepicker #payDay_To></mat-datepicker>
                </div>
                </td>
            </tr>
        </table>      
        <div style="margin: 10px 0px 10px 0px;">
            <button mat-raised-button (click)="searchPayContract()" class="search-btn">&nbsp;&nbsp;検索&nbsp;&nbsp;</button>&nbsp;&nbsp;
            <button mat-raised-button (click)="createNew()" color="warn">&nbsp;新規登録&nbsp;</button>
        </div>
        </div>    
        
    </mat-expansion-panel>
</div>        
<ngx-spinner type="ball-spin-clockwise" bdOpacity="0.7"></ngx-spinner>
<div class="mat-elevation-z8 main data">
    <table mat-table [dataSource]="dataSource" matSort>
    
        <ng-container matColumnDef="bukkenNo">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> 物件番号 </th>
        <td mat-cell *matCellDef="let element"> {{element.bukkenNo}} </td>
        </ng-container>

        <ng-container matColumnDef="bukkenName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> 物件名 </th>
        <td mat-cell *matCellDef="let element"> {{element.bukkenName}} </td>
        </ng-container>
       
        <ng-container matColumnDef="supplierName">
        <th mat-header-cell *matHeaderCellDef> 取引先 </th>
        <td mat-cell *matCellDef="let element">{{element.supplierName}}</td>
        </ng-container>

        <ng-container matColumnDef="payContractDay">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> 契約予定日 </th>
        <td mat-cell *matCellDef="let element">{{formatDay(element.payContractDay, 'yyyy/MM/dd')}}</td>
        </ng-container>

        <ng-container matColumnDef="payContractFixDay">
        <th mat-header-cell *matHeaderCellDef> 契約確定日 </th>
        <td mat-cell *matCellDef="let element">{{formatDay(element.payContractFixDay, 'yyyy/MM/dd')}}</td>
        </ng-container>
        <!--hiranomemo 支払種別 追加-->
        <ng-container matColumnDef="paymentCode">
        <th mat-header-cell *matHeaderCellDef> 支払種別 </th>
        <td mat-cell *matCellDef="let element"> <!--{{element.paymentCode}} -->
            <div *ngFor="let detail of element.details; index as pos" [ngClass]="{'ct-list': true, 'ct-notlast': (pos < element.details.length - 1)}">{{getPaymentName(detail.paymentCode)}}</div>
        </td>
        </ng-container>
         <!--hiranomemo  支払予定日 追加-->
        <ng-container matColumnDef="contractDay">
        <th mat-header-cell *matHeaderCellDef> 支払予定日 </th>
        <td mat-cell *matCellDef="let element"> <!--{{element.contractDay}} -->
            <div *ngFor="let detail of element.details; index as pos" [ngClass]="{'ct-list': true, 'ct-notlast': (pos < element.details.length - 1)}">{{formatDay(detail.contractDay , 'yyyy/MM/dd')}}</div>
        </td>
        </ng-container>
   
        <ng-container matColumnDef="delete">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let element"> 
            <button mat-raised-button (click)="deleteRow(element)" class="delete_btn">削除</button>            
        </td>
        </ng-container>
        
        <!-- 詳細 Column -->
        <ng-container matColumnDef="detail">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let element"> 
            <button mat-raised-button (click)="showDetail(element)" color="warn">詳細</button>            
        </td>
        </ng-container>
    
        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" [ngClass]="{'highlighted': selectedRowIndex == row.pid}" (mouseover)="highlight(row)"></tr>
    </table>        
    <mat-paginator [pageSizeOptions]="[10, 20, 50]" showFirstLastButtons></mat-paginator>
</div>