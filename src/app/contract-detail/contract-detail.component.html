<ngx-spinner type="ball-spin-clockwise" bdOpacity="0.7"></ngx-spinner>
<div  class="detail-div">
    <div class="register-div">
        <button mat-raised-button class="button bukken-button" (click)="backToList()">土地情報</button>
        <button mat-raised-button class="button export-button" (click)="export()">契約書出力</button>
        <button mat-raised-button color="primary" class="button" (click)="save()">登録</button>
    </div>
    <br>
    <!--/土地情報契約-->
    <table class="detail-tbl-min">  
        <tr>
            <td colspan="8"><span class="min">契約区分</span></td>
        </tr>
        <tr>
            <th>物件番号</th>
            <td><input type="text" class="width150" [attr.disabled]="true" [ngModel]="data.bukkenNo"></td>            
            <th>契約番号</th>
            <td>
                <input type="text" class="width150" [attr.disabled]="true" value="{{data.bukkenNo + '-' + contract.contractNumber}}">
            </td>
            <th>契約担当者</th>
            <td colspan="3">
                <app-select-component [codes]="getEmps()" [(ngModel)]="contract.scale"></app-select-component>
            </td> 
        </tr>        
        <tr>
            <th>即決和解</th>
            <td>
                <app-select-component [codes]="getCode('006')" [(ngModel)]="contract.promptDecideFlg"></app-select-component>
            </td>
            <th>契約種別</th>
            <td>
                <app-select-component [codes]="getCode('012')" [(ngModel)]="contract.contractType"></app-select-component>
            </td>
            <td colspan="4">
                <mat-checkbox *ngFor="let code of getCode('008')">{{code.name}}&nbsp;&nbsp;</mat-checkbox>
            </td>  
            
        </tr>
        <tr>             
            <th>不可分</th>
            <td><app-select-component [codes]="getCode('006')" [(ngModel)]="contract.indivisibleFlg"></app-select-component></td>       
            <th>三為</th>
            <td><app-select-component [codes]="getCode('006')" [(ngModel)]="contract.thirdPartyFlg"></app-select-component></td>
            <th>等価交換</th>
            <td><app-select-component [codes]="getCode('006')" [(ngModel)]="contract.equiExchangeFlg"></app-select-component></td>
            <th>売買</th>
            <td><app-select-component [codes]="getCode('009')" [(ngModel)]="contract.tradingType"></app-select-component></td>
        </tr>       
    </table>
    <!--/土地情報契約-->

    <!--/建物情報契約-->
    <table class="detail-tbl-min">  
        <tr>
            <td><span class="min">売主・不可分選択</span></td>
        </tr>
        <tr>
            <td>
                <div class="contact-div">
                    <table>
                        <thead class="list-header">
                            <th>売主選択</th>
                            <th>不可分選択</th>
                            <th>区分</th>
                            <th><span style="display: inline-block;width: 200px;">所在</span></th>
                            <th>地番</th>
                            <th>家屋番号</th>
                            <th>所有者<br>（売主・登記名義人）</th>
                            <th>登記名義人</th>
                            <th style="display: block;border:none" class="width300">所有者住所<br>（売主住所）</th>
                            <!--<th>契約者名</th>-->
                            <th>地目</th>
                            <th>地積</th>
                            <th>地積のうち借地契約面積</th>
                            <th>種類</th>
                            <th>構造</th>
                            <th>階建</th>
                            <th>床面積</th>
                        </thead>
                        <tbody class="list-body">
                            <tr *ngFor="let item of data.locations; index as pos">
                                <td><mat-checkbox color="primary" [(ngModel)]="item.isContract" (change)="change(item, true)" *ngIf="!otherLocs.includes(item.pid.toString())" ></mat-checkbox></td>
                                <td><mat-checkbox color="primary" [(ngModel)]="item.isDepend" (change)="change(item, false)"></mat-checkbox></td>
                                <td>{{getCodeTitle('007', item.locationType)}}</td>
                                <td class="width200 text-left">{{item.address}}</td>
                                <td>{{item.blockNumber}}</td>
                                <td>{{item.buildingNumber}}</td>
                                <td>{{item.owner}}</td>
                                <td>
                                    <label *ngIf="!(item.sharers.length > 1)">{{item.owner}}</label>
                                    <a class="sharerBtn" href="#" *ngIf="item.sharers.length > 1">表示</a> 
                                </td>
                                <td class="width300 text-left">{{item.ownerAdress}}</td>
                                <!--<td><input type="text" *ngIf="item.isContract || item.isDepend" class="width150" [(ngModel)]="item.contractData.contractorName"></td>-->
                                <td></td>
                                <td>{{item.area > 0 ? item.area + '&nbsp;㎡' : ''}}</td>
                                <td><span *ngIf="isLand(item)"><input type="text" class="width80 number" (keypress)="numericOnly($event)" [(ngModel)]="item.contractData.contractArea">&nbsp;㎡</span></td>
                                <td><app-select-component *ngIf="isBuild(item)" [codes]="getCode('004')" [exclass]="true" [(ngModel)]="item.contractData.dependType"></app-select-component></td>
                                <td><textarea *ngIf="isBuild(item)" class="width120" rows="3" [(ngModel)]="item.contractData.dependStructure"></textarea></td>
                                <td><span *ngIf="isBuild(item)"><input type="text" class="width40" [(ngModel)]="item.contractData.dependFloor">&nbsp;階建</span></td>
                                <td><textarea *ngIf="isBuild(item)" class="width120" rows="3" [(ngModel)]="item.contractData.dependFloorArea"></textarea></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </td>
        </tr>
    </table>        

    <table class="detail-tbl-min">
        <tr>
            <td colspan="8">
                <span class="min"><label>契約内容</label></span>                        
            </td>
        </tr>
        <tr>
            <th>売買代金</th>
            <td colspan="9">
                <input type="text" [(ngModel)]="contract.tradingPrice" class="width100 number" (keypress)="numericOnly($event)">&nbsp;円
            </td>
        </tr>
        <tr>
            <th>売買代金（土地）</th>
            <td colspan="2">
                <input type="text" [(ngModel)]="contract.tradingLandPrice" class="width100 number" (keypress)="numericOnly($event)">&nbsp;円
            </td>
            <th>売買代金（建物）</th>
            <td colspan="2"><input type="text" [(ngModel)]="contract.tradingBuildingPrice" class="width100 number" (keypress)="numericOnly($event)">&nbsp;円</td>
            <th>売買代金（借地権）</th>
            <td colspan="2"><input type="text" [(ngModel)]="contract.tradingLeasePrice" class="width100 number" (keypress)="numericOnly($event)">&nbsp;円</td>
            <th>実測精算単価</th>
            <td><input type="text" [(ngModel)]="contract.setlementPrice" class="width100 number" (keypress)="numericOnly($event)">&nbsp;円</td> 
        </tr>
        <tr>
            <th>内金①</th>
            <td><input type="text" [(ngModel)]="contract.deposit1" class="width100 number" (keypress)="numericOnly($event)">&nbsp;円</td>
            <td>
                <input type="text" [matDatepicker]="deposit1" class="width100" [(ngModel)]="contract.deposit1">
                <mat-datepicker-toggle matSuffix [for]="deposit1" class="picker-icon"></mat-datepicker-toggle>
                <mat-datepicker #deposit1></mat-datepicker>
            </td>
            <th>内金②</th>
            <td><input type="text" [(ngModel)]="contract.deposit2" class="width100 number" (keypress)="numericOnly($event)">&nbsp;円</td>
            <td>
                <input type="text" [matDatepicker]="deposit2" class="width100" [(ngModel)]="contract.deposit2">
                <mat-datepicker-toggle matSuffix [for]="deposit2" class="picker-icon"></mat-datepicker-toggle>
                <mat-datepicker #deposit2></mat-datepicker>
            </td>
            <th>手付金</th>
            <td><input type="text" [(ngModel)]="contract.earnestPrice" class="width100 number" (keypress)="numericOnly($event)">&nbsp;円</td>
            <td>
                <input type="text" [matDatepicker]="earnestPrice" class="width100" [(ngModel)]="contract.earnestPrice">
                <mat-datepicker-toggle matSuffix [for]="earnestPrice" class="picker-icon"></mat-datepicker-toggle>
                <mat-datepicker #earnestPrice></mat-datepicker>
            </td>
            <th>売買残代金</th>
            <td><input type="text" [(ngModel)]="contract.tradingBalance" class="width100 number" (keypress)="numericOnly($event)">&nbsp;円</td> 
        </tr>
        <tr>
            <th>優先分譲面積<br>（専有面積）</th>
            <td colspan="2"><input type="text" [(ngModel)]="contract.prioritySalesArea" class="width100 number" (keypress)="numericOnly($event)">&nbsp;㎡</td>
            <th>優先分譲戸数（階）</th>
            <td colspan="2"><input type="text" [(ngModel)]="contract.prioritySalesFloor" class="width100 number" (keypress)="numericOnly($event)">&nbsp;階</td>
            <th>優先分譲予定価格</th>
            <td colspan="5"><input [(ngModel)]="contract.prioritySalesPlanPrice" type="text" class="width100 number" (keypress)="numericOnly($event)">&nbsp;円</td>            
        </tr>
       <tr>
           <th>明渡期日</th>
           <td colspan="2">
                <input type="text" [matDatepicker]="vacationDay" class="width100" [(ngModel)]="contract.vacationDayMap">
                <mat-datepicker-toggle matSuffix [for]="vacationDay" class="picker-icon"></mat-datepicker-toggle>
                <mat-datepicker #vacationDay></mat-datepicker>
           </td>
           <th>契約日</th>
           <td colspan="7">
                <input type="text" [matDatepicker]="contractDay" class="width100" [(ngModel)]="contract.contractDayMap">
                <mat-datepicker-toggle matSuffix [for]="contractDay" class="picker-icon"></mat-datepicker-toggle>
                <mat-datepicker #contractDay></mat-datepicker>
           </td>
       </tr>

        <tr>

        <th>決済代金</th>
        <td colspan="2">
            <input type="text" class="width100 number" (keypress)="numericOnly($event)">&nbsp;円
        </td>
        
        <th>決済日</th>
        <td colspan="2">
            <input type="text" [matDatepicker]="test2" class="width100" >
            <mat-datepicker-toggle matSuffix [for]="test2" class="picker-icon"></mat-datepicker-toggle>
            <mat-datepicker #test2></mat-datepicker>
        </td>
        <th>即決和解申請日</th>
        <td colspan="2">
            <input type="text" [matDatepicker]="test4" class="width100" >
            <mat-datepicker-toggle matSuffix [for]="test4" class="picker-icon"></mat-datepicker-toggle>
            <mat-datepicker #test4></mat-datepicker>
        </td>
        <th>和解成立後</th>
        <td><input type="text" value="1か月以内"  class="width100 number" (keypress)="numericOnly($event)"></td>
        
       </tr>
        <tr>
            <th>備考</th>
            <td colspan="7">
                <input type="text" class="width85Per">
            </td>
        </tr>
       <tr>
            <th>計画地の公図</th>
            <td colspan="9" style="border-top: solid 1px rgba(197, 191, 191, 0.822);">
                <label *ngIf="!(contract.pid > 0)" style="color:red">※契約情報を登録後に添付可能となります。</label>   
                <app-file contractInfoId="{{contract.pid}}" *ngIf="contract.pid > 0" (uploaded)="uploaded($event)"></app-file> 
                
                <table style="margin-left: 5px;">
                    <tr *ngFor="let map of contract.contractFiles">
                        <td class="min-width160"><a [attr.href]="map.attachFilePath + map.attachFileName" target="_blank">{{map.attachFileName}}</a></td>
                        <td><button mat-flat-button class="attach-btn" (click)="deleteFile(map)">削除</button></td>
                    </tr>
                   
                </table>
                
            </td> 
       </tr>
    </table>
    
    <!--20191217ADD削除の可能性高い為DBは未作成-->
    <!--<table class="detail-tbl-minDl">
        <tr>
            <td colspan="8">
                <span class="minDl"><label>契約備考</label></span>                        
            </td>
        </tr>
        <tr>
            <th>決済代金</th>
            <td>
                <input type="text" class="width100 number" (keypress)="numericOnly($event)">&nbsp;円
            </td>
            
            <th>決済日</th>
            <td>
                <input type="text" [matDatepicker]="test2" class="width100" >
                <mat-datepicker-toggle matSuffix [for]="test2" class="picker-icon"></mat-datepicker-toggle>
                <mat-datepicker #test2></mat-datepicker>
            </td>
            <th>即決和解申請日</th>
            <td><input type="text" [matDatepicker]="test4" class="width100" >
                <mat-datepicker-toggle matSuffix [for]="test4" class="picker-icon"></mat-datepicker-toggle>
                <mat-datepicker #test4></mat-datepicker>
            </td>
            <th>和解成立後</th>
            <td><input type="text" value="1か月以内"  class="width100 number" (keypress)="numericOnly($event)"></td>
            
        </tr>
        
        <tr>
            <th>決済引渡予定日</th>
            <td>
                <input type="text" [matDatepicker]="test1" class="width100" >
                <mat-datepicker-toggle matSuffix [for]="test1" class="picker-icon"></mat-datepicker-toggle>
                <mat-datepicker #test1></mat-datepicker>
            </td>
            <th>留保金</th>
            <td>
                <input type="text" class="width100 number" (keypress)="numericOnly($event)">&nbsp;円
            </td>
        </tr>
        <tr>
            <th>即決和解申請期日</th>
            <td><input type="text" [matDatepicker]="test3" class="width100" >
                <mat-datepicker-toggle matSuffix [for]="test3" class="picker-icon"></mat-datepicker-toggle>
                <mat-datepicker #test3></mat-datepicker>
            </td>
            <td><input type="text" value="1か月以内"  class="width100 number" (keypress)="numericOnly($event)"></td>
            <th>即決和解費用</th>
            <td><input type="text" class="width100 number" (keypress)="numericOnly($event)">&nbsp;円</td> 
        </tr>
        <tr>
            <th>即決日</th>
            <td><input type="text" [matDatepicker]="test5" class="width100" >
                <mat-datepicker-toggle matSuffix [for]="test5" class="picker-icon"></mat-datepicker-toggle>
                <mat-datepicker #test5></mat-datepicker>
            </td>
            <th>明渡日</th>
            <td><input type="text" [matDatepicker]="test6" class="width100" >
                <mat-datepicker-toggle matSuffix [for]="test6" class="picker-icon"></mat-datepicker-toggle>
                <mat-datepicker #test6></mat-datepicker>
            </td>
            <th>明渡(留保金支払)日</th>
            <td colspan="3">
                <input type="text" [matDatepicker]="test7" class="width100" >
                <mat-datepicker-toggle matSuffix [for]="test7" class="picker-icon"></mat-datepicker-toggle>
                <mat-datepicker #test7></mat-datepicker>
            </td>
            </tr>
        <tr>
            <th>合意解除</th>
            <td><app-select-component [codes]="getCode('006')"></app-select-component></td>
            <th>テナント立退き</th>
            <td><app-select-component [codes]="getCode('006')"></app-select-component></td>
            <th>紙</th>
            <td><app-select-component [codes]="getCode('006')"></app-select-component></td>
            <th>覚書</th>
            <td><app-select-component [codes]="getCode('006')"></app-select-component></td>          
        </tr>
       <tr>
           <th>登記費用</th>
           <td>
            <input  type="text" class="width100 number" (keypress)="numericOnly($event)">&nbsp;円
           </td>
           <th>成果簿予定完成日</th>
           <td>
                <input type="text" [matDatepicker]="test8" class="width100">
                <mat-datepicker-toggle matSuffix [for]="test8" class="picker-icon"></mat-datepicker-toggle>
                <mat-datepicker #test8></mat-datepicker>
           </td>
           <th>業務委託・仲介等</th>
           <td>
            <input type="text" class="width200 number" (keypress)="numericOnly($event)">
           </td>
           <th>不可分成立日</th>
           <td>
                <input type="text" [matDatepicker]="test9" class="width100" >
                <mat-datepicker-toggle matSuffix [for]="test9" class="picker-icon"></mat-datepicker-toggle>
                <mat-datepicker #test9></mat-datepicker>
           </td>
        </tr>
        <tr>
            <th>備考</th>
            <td colspan="7">
                <input type="text" class="width85Per">
            </td>
        </tr>

    </table>-->
    <!--20191217ADD削除の可能性高い為DBは未作成-->

    <table class="detail-tbl-min">
        <tr>
            <td colspan="8">
                <span class="min" style="width: 155px !important;">本件マンションの計画概要</span>                        
            </td>
        </tr>
        <tr>
            <th>敷地面積</th>
            <td><input type="text" [(ngModel)]="contract.siteArea" class="width100 number" (keypress)="floatOnly($event)">&nbsp;㎡</td>
            <th>有効敷地面積</th>
            <td><input type="text" [(ngModel)]="contract.siteAvailableArea" class="width100 number" (keypress)="floatOnly($event)">&nbsp;㎡</td>
            <th>構造</th>
            <td><input type="text" [(ngModel)]="contract.structure" class="width150"></td>
            <th>規模</th>
            <td><input type="text" [(ngModel)]="contract.scale" lass="width200"></td> 
        </tr>
    </table> 
    
    <table class="detail-tbl-min">
        <tr>
            <td colspan="8">
                <span class="min"><label>事業スケジュール</label></span>                        
            </td>
        </tr>
        <tr>
            <th>建築確認取得</th>
            <td>
                <input type="text" [matDatepicker]="acquisitionConfirmDay" class="width100" [(ngModel)]="contract.acquisitionConfirmDayMap">
                <mat-datepicker-toggle matSuffix [for]="acquisitionConfirmDay" class="picker-icon"></mat-datepicker-toggle>
                <mat-datepicker #acquisitionConfirmDay></mat-datepicker>
            </td>
            <th>計画建物着工</th>
            <td>
                <input type="text" [matDatepicker]="startScheduledDay" class="width100" [(ngModel)]="contract.startScheduledDayMap">
                <mat-datepicker-toggle matSuffix [for]="startScheduledDay" class="picker-icon"></mat-datepicker-toggle>
                <mat-datepicker #startScheduledDay></mat-datepicker>
            </td>
            <th>優先分譲契約締結</th>
            <td>
                <input type="text" [matDatepicker]="prioritySalesAgreementDay" class="width100" [(ngModel)]="contract.prioritySalesAgreementDayMap">
                <mat-datepicker-toggle matSuffix [for]="prioritySalesAgreementDay" class="picker-icon"></mat-datepicker-toggle>
                <mat-datepicker #prioritySalesAgreementDay></mat-datepicker>
            </td>
            <th>計画建物竣工</th>
            <td>
                <input type="text" [matDatepicker]="finishScheduledDay" class="width100" [(ngModel)]="contract.finishScheduledDayMap">
                <mat-datepicker-toggle matSuffix [for]="finishScheduledDay" class="picker-icon"></mat-datepicker-toggle>
                <mat-datepicker #finishScheduledDay></mat-datepicker>
            </td> 
        </tr>
        <tr>
            <th>計画建物竣工</th>
            <td colspan="7">
                <input type="text" [(ngModel)]="contract.finishScheduledNote" class="width150">
            </td>
        </tr>
    </table> 

    <!--/建物情報契約-->
    <br>
    <mat-divider></mat-divider>
    <div class="register-div" style="margin-top:10px">
        <button mat-raised-button class="button bukken-button" (click)="backToList()">土地情報</button>
        <button mat-raised-button color="primary" class="button" (click)="save()">登録</button>
    </div>

</div>    
